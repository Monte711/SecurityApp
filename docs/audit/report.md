# Аудит агентов UECP

## Обнаруженные артефакты агентов

### Устаревшие агенты (подлежат архивации)

1. **`start-agent.ps1`** (корневая папка)
   - Тип: PowerShell скрипт-лаунчер
   - Назначение: Запускает `agent.ps1` в новом окне
   - Статус: **УСТАРЕЛ** - упрощенная реализация
   - Причина архивации: Заменен полнофункциональным Go агентом

2. **`agent.ps1`** (корневая папка)
   - Тип: PowerShell агент сбора данных
   - Назначение: Базовый сбор системной информации
   - Статус: **УСТАРЕЛ** - ограниченная функциональность
   - Причина архивации: Только базовые метрики, без анализа безопасности

3. **`agent/windows/simple_sender.ps1`**
   - Тип: Упрощенный PowerShell агент
   - Назначение: Тестовая отправка данных
   - Статус: **УСТАРЕЛ** - минимальная функциональность
   - Причина архивации: Дублирует функции основного агента

4. **`agent/windows/start_agent.ps1`**
   - Тип: PowerShell лаунчер для Windows папки
   - Назначение: Запуск автоматической отправки
   - Статус: **УСТАРЕЛ** - использует auto_sender.ps1
   - Причина архивации: Заменен прямым запуском Go агента

5. **`agent/windows/auto_sender.ps1`**
   - Тип: Автоматический отправитель данных
   - Назначение: Периодическая отправка базовых данных
   - Статус: **УСТАРЕЛ** - упрощенные данные
   - Причина архивации: Не использует возможности Go агента

### Актуальный агент (основная реализация)

**Расположение**: `agent/windows/`

**Ключевые файлы**:
- `uecp-agent.exe` - основной исполняемый файл (Go)
- `config.json` - конфигурация агента
- `cmd/uecp-agent/main.go` - исходный код точки входа
- `internal/` - модули функциональности:
  - `collect/` - сбор данных (процессы, автозапуски, безопасность)
  - `recommend/` - анализ и рекомендации безопасности
  - `transport/` - отправка данных
  - `store/` - локальное хранение (spool)
  - `util/` - утилиты (PowerShell, хеши, подписи)

**Возможности актуального агента**:
- ✅ Комплексный сбор системной информации
- ✅ Анализ безопасности Windows (9 правил)
- ✅ Проверка цифровых подписей
- ✅ SHA256 хеширование файлов
- ✅ Offline режим с локальным спулом
- ✅ Structured logging
- ✅ Retry логика
- ✅ Graceful degradation при ограниченных правах

## Структура данных актуального агента

### Формат события
```json
{
  "event_type": "host_posture",
  "timestamp": "2025-08-25T15:38:40Z",
  "agent": {
    "agent_id": "uecp-agent-DESKTOP-HKR714G",
    "agent_version": "1.0.0",
    "hostname": "DESKTOP-HKR714G"
  },
  "host": {
    "host_id": "guid-from-registry",
    "hostname": "DESKTOP-HKR714G",
    "os_version": "Windows 11 Pro",
    "uptime_seconds": 3600,
    "timezone": "UTC+03:00"
  },
  "inventory": {
    "processes": [...],
    "autoruns": {
      "registry": [...],
      "startup_folders": [...],
      "services_auto": [...],
      "scheduled_tasks": [...]
    }
  },
  "security": {
    "defender": {...},
    "firewall": {...},
    "uac": {...},
    "rdp": {...},
    "bitlocker": {...},
    "smb1": {...}
  },
  "findings": [...]
}
```

## Выводы аудита

1. **Множественность реализаций**: Обнаружено 5 устаревших агентов различной функциональности
2. **Фрагментация**: Агенты дублируют базовую функциональность без единого стандарта
3. **Качество данных**: Устаревшие агенты отправляют упрощенные события без анализа безопасности
4. **Актуальный агент**: Go реализация обеспечивает профессиональный уровень сбора данных
5. **Необходимые действия**: Архивация устаревших агентов и стандартизация на Go реализации

## Рекомендации

1. Перенести все устаревшие агенты в `archive/old_agents/`
2. Обновить документацию с указанием на единственный актуальный агент
3. Создать четкие инструкции по использованию Go агента
4. Проверить совместимость форматов данных с API и UI
